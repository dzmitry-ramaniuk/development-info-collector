# Типовые проблемы и риски

## Потеря сообщений
- Причины: недостаточная репликация, `acks=0`, сбои диска.
- Противодействие: минимальный фактор репликации 3, `acks=all`, мониторинг ISR.

## Дубликаты сообщений
- Возможны при повторной отправке producer'ом или повторном чтении consumer'ом.
- Решение: idempotent producers, транзакционные сессии, дедупликация на уровне бизнес-логики.

## Дисбаланс партиций
- Нерavnomерная нагрузка при плохом выборе ключей.
- Используйте хеширование ключей, ребалансировку, мониторинг метрик `records-lag`.

## Задержки чтения (consumer lag)
- Причины: медленная обработка, недостаточно consumer'ов, перебои сети.
- Подходы: масштабирование consumer group, backpressure, оптимизация обработки.

## Переполнение диска
- При длительной ретенции и больших объёмах.
- Устанавливайте политику очистки (`log.retention.bytes`, `log.retention.hours`), используйте tiered storage.

## Сложности миграции версий
- Различия между ZooKeeper и KRaft, изменения API.
- Планируйте rolling upgrade, тестируйте на staging, используйте совместимые клиенты.
