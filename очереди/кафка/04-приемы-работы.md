# Приёмы эффективной работы


## Содержание

1. [Проектирование топиков](#проектирование-топиков)
2. [Настройка продюсеров](#настройка-продюсеров)
3. [Работа с потребителями](#работа-с-потребителями)
4. [Тестирование и среда](#тестирование-и-среда)
5. [Эксплуатация](#эксплуатация)

## Проектирование топиков
- Разделяйте бизнес-домены по топикам, избегайте «топика-всего».
- Планируйте количество партиций с запасом: легче добавить consumer'ов, чем перепартиционировать.
- Используйте соглашения об именовании (`<domain>.<context>.<event>`).

## Настройка продюсеров
- Включайте idempotence (`enable.idempotence=true`).
- Регулируйте `linger.ms` и `batch.size` для лучшей пропускной способности.
- Используйте ключи сообщений для обеспечения локальности и порядка.

## Работа с потребителями
- Настройте `max.poll.interval.ms` и `max.poll.records` под длительность обработки.
- Для критичных задач применяйте ручной commit offset после успешной обработки.
- Реализуйте ретраи с дедлайнами и алерты на consumer lag.

## Тестирование и среда
- Локально используйте Testcontainers или встроенный Kafka cluster.
- Пишите контрактные тесты с Schema Registry и серилизацией.
- Автоматизируйте проверки политики доступа и квот.

## Эксплуатация
- Мониторьте throughput, latency, ISR, leader elections.
- Планируйте capacity, анализируйте рост трафика.
- Регулярно проверяйте версии клиентов и совместимость API.
